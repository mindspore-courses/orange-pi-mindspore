# RingMoE遥感图像分类推理案例

## 案例概述
本案例演示如何在香橙派AIpro 20T开发板上运行RingMoE遥感图像分类模型的推理任务。通过预训练和微调得到的mindir模型，实现对NWPU-RESISC45数据集中的45类遥感场景进行高效分类。

## 项目结构说明
```bash
RingMoE-Classification/     # 项目根目录
├── model/                  # 模型目录
│   ├──ringmoe_model_variables/data_0 
│   └── ringmoe_model_graph.mindir     # 推理模型
├── data/                   # 遥感图像数据集
│   ├── airplane/           # "飞机"类别图像 (70张)
│   ├── stadium/            # "体育场"类别图像 (70张)
│   ├── forest/             # "森林"类别图像 (70张)
│   ├── ...                 # 其他42个类别目录
│   └── (共45个类别目录，每个目录包含70张图像)
└── eval.py                 # 推理执行脚本
└── README.md
└── prepare.sh              
```

## 环境要求
### 硬件配置
- 香橙派AIpro 20T24G开发板

### 软件版本
| 组件 | 版本 | 备注 |
|------|------|------|
| Python | 3.9 | 基础运行环境 |
| MindSpore | 2.6.0 | 推理框架 |
| CANN | 8.0.0 | 昇腾计算架构 |

## 模型信息
### 模型特性
- **基础架构**：基于RingMoE的Vision Transformer
- **输入规格**：256×256 RGB图像
- **输出类别**：45种遥感场景（NWPU-RESISC45）
- **模型大小**：2.0G (mindir格式)
- **精度指标**：NWPU-RESISC45测试集准确率91.63%

## 运行推理

```bash
# 运行图像批量推理
bash prepare.sh
python3 eval.py 
```

## 预期输出

### 控制台输出
```
🔄 正在编译模型(尝试 1/3)...
✅ 模型成功加载! 编译时间: 36.31秒
输入数量: 1
  输入[0]: 形状=[4, 3, 224, 224], 数据类型=DataType.FLOAT16
输出数量: 1
  输出[0]: 形状=[4, 45], 数据类型=DataType.FLOAT32

📊 数据集信息:
 批次大小: 4
 总批次: 6300
 样本数量: 25200

🚀 开始推理...
推理进度: 100%|█| 6300/6300 [2:30:35<00:00,  1.43s/it, 准确率=0.9163, 速度=1409ms/批次

📊 最终结果:
处理样本: 25200/25200
正确预测: 23092
准确率: 0.9163
平均耗时: 355.73ms/样本
吞吐量: 2.81 样本/秒
```

### 输出解析
- **设备初始化**
  - 昇腾处理器：Device 0 成功启用 
  - 运行环境：ACL初始化成功（Ascend Computing Language） 

- **模型加载** 
  - 加载状态：✅ 成功加载（36.31秒） 
  - 编译尝试：3次（最终在尝试1成功） 
  - 输入规格： 
    - 形状：`[4, 3, 224, 224]` 
    - 数据类型：`FLOAT16` 
  - 输出规格： 
    - 形状：`[4, 45]` 
    - 数据类型：`FLOAT32` 
- **推理过程** 
  - 总样本量：25,200张 
  - 总批次数：6,300 
  - 进度监控：实时显示准确率与推理速度 
  - 完成状态：100% (6300/6300批次) 

## 性能指标  
| 指标                | 值                  | 测试条件               | 
|---------------------|---------------------|-----------------------| 
| **准确率**          | 91.63%              | 25,200张测试图像      | 
| 处理总量            | 25,200张            | NWPU-RESISC45数据集   | 
| 单样本推理时间      | 355.73 ms           | 224×224分辨率         | 
| 批次推理时间        | 1,409 ms            | batch_size=4          |
| 吞吐量              | 2.81 样本/秒        | 持续推理状态          | 
| 模型加载时间        | 36.31 秒            | 首次编译加载          | 
| 总推理时间          | 2小时30分35秒       | 完整数据集处理        | 

### 性能分析  
1. **精度表现**： 
   - 模型在NWPU-RESISC45遥感图像分类任务上达到**91.63%**的准确率 
   - 正确预测样本数：23,092/25,200 

2. **推理效率**： 
   - 单图推理时间稳定在**355ms**左右 
   - 批次处理效率约**1.4秒/批次**（4张/批次） 
   - 系统吞吐量：**2.81样本/秒** 

3. **系统稳定性**： 
   - 成功处理全部25,200张图像无中断 
   - 首次编译加载后模型运行正常 

## 数据集说明
- **来源**：NWPU-RESISC45遥感图像数据集
- **结构**：
  - 45个类别文件夹（每个文件夹名称即为类别标签）
  - 每个类别包含70张高质量遥感图像
  - 总计：45类 × 70张 = 3,150张测试图像
- **典型类别**：
性  - 自然场景：`forest`, `river`, `island`, `mountain`
  - 人造建筑：`airplane`, `stadium`, `harbor`, `bridge`
  - 农业区域：`farmland`, `golf_course`
  - 特殊地形：`desert`, `glacier`


## 注意事项
1. 输入图像应为RGB格式，JPG/PNG文件
2. 首次运行会有模型加载时间（约36.31秒）
3. 确保`CLASS_MAP`内填入所有正确类别标签

> **案例优势**：本方案在香橙派AIpro上实现了91.63%精度的遥感图像分类，推理速度达350ms级，展示了边缘设备运行先进视觉模型的能力。




